<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Интерактивная карта велопарковок Минска</title>
    
    <!-- Подключение библиотеки Leaflet.js для создания карты -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    
    <!-- Подключение Tailwind CSS для стилизации -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Стили для карты и страницы -->
    <style>
        /* Устанавливаем высоту контейнера карты, чтобы она была видимой */
        #map { 
            height: 75vh; 
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        /* Стили для всплывающих окон на карте */
        .leaflet-popup-content-wrapper {
            border-radius: 0.5rem;
        }
        .leaflet-popup-content {
            font-size: 14px;
            font-family: 'Inter', sans-serif;
            margin: 10px 15px;
            width: auto !important;
        }
        /* Стили для кастомной иконки парковки */
        .parking-icon {
            background-color: #3b82f6; /* blue-500 */
            color: white;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 16px;
            line-height: 28px;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        /* Стили для кнопки "Найти меня" */
        .leaflet-control-custom {
            cursor: pointer;
            background-color: white;
            width: 34px;
            height: 34px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 4px;
            box-shadow: 0 1px 5px rgba(0,0,0,0.65);
        }
        .leaflet-control-custom:hover {
            background-color: #f3f4f6;
        }
        /* Стили для кнопок в popup */
        .popup-button {
            display: inline-flex;
            align-items: center;
            padding: 6px 10px;
            margin-top: 8px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            background-color: #f9fafb;
            transition: background-color 0.2s;
        }
        .popup-button:hover {
            background-color: #f3f4f6;
        }
        .popup-button svg {
            margin-right: 5px;
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100 font-sans p-4 md:p-8">

    <div class="max-w-7xl mx-auto bg-white p-6 rounded-lg shadow-lg relative">
        <div class="text-center mb-6">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800">Карта велопарковок Минска</h1>
            <p class="text-gray-600 mt-2">Официальные велопарковки на автостоянках. Нажмите на метку для подробностей.</p>
        </div>
        
        <!-- Контейнер, в котором будет отображаться карта -->
        <div id="map"></div>
        
        <!-- Блок с ценами -->
        <div id="price-info" class="absolute top-20 right-8 md:top-24 md:right-10 bg-white bg-opacity-90 p-3 rounded-lg shadow-md z-[1000]">
            <h4 class="font-bold text-sm mb-1">Хранение велосипеда:</h4>
            <ul class="text-xs list-disc list-inside">
                <li><span class="font-semibold">в час:</span> 0,07 руб.</li>
                <li><span class="font-semibold">в сутки:</span> 0,82 руб.</li>
                <li><span class="font-semibold">в месяц:</span> 12,00 руб.</li>
            </ul>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Переменная для хранения местоположения пользователя
            let userLocation = null;
            
            // Данные о велопарковках
            const bikeParkingData = [
                // Добавлен район для будущей фильтрации
                { lat: 53.8687, lng: 27.6533, address: 'ул. Васнецова, 14', description: 'Автостоянка № 17', district: 'Заводской' },
                { lat: 53.8407, lng: 27.6575, address: 'ул. Уборевича, 89', description: 'Автостоянка № 18', district: 'Заводской' },
                { lat: 53.8765, lng: 27.6897, address: 'ул. Алтайская, 1г', description: 'Автостоянка № 21', district: 'Заводской' },
                { lat: 53.8415, lng: 27.6569, address: 'ул. Уборевича, 81', description: 'Автостоянка № 23', district: 'Заводской' },
                { lat: 53.8559, lng: 27.6322, address: 'ул. Малинина, 1', description: 'Автостоянка № 46', district: 'Заводской' },
                { lat: 53.8837, lng: 27.7121, address: 'ул. Нестерова, 47', description: 'Автостоянка № 71', district: 'Заводской' },
                { lat: 53.8524, lng: 27.6749, address: 'ул. Ротмистрова, 61', description: 'Автостоянка № 73', district: 'Заводской' },
                { lat: 53.8810, lng: 27.7011, address: 'ул. Илимская, 10а', description: 'Автостоянка № 82', district: 'Заводской' },
                { lat: 53.8452, lng: 27.5925, address: 'Игуменский тракт, 14', description: 'Автостоянка № 36', district: 'Ленинский' },
                { lat: 53.8341, lng: 27.5939, address: 'Игуменский тракт, 51', description: 'Автостоянка № 38', district: 'Ленинский' },
                { lat: 53.8683, lng: 27.6045, address: 'ул. Якубова, 9', description: 'Автостоянка № 41', district: 'Ленинский' },
                { lat: 53.8436, lng: 27.5878, address: 'ул. Сырокомли, 1', description: 'Автостоянка № 77', district: 'Ленинский' },
                { lat: 53.8340, lng: 27.5790, address: 'ул. Прушинских, 45', description: 'Автостоянка № 78', district: 'Ленинский' },
                { lat: 53.8519, lng: 27.5815, address: 'ул. П. Шпилевского, 50', description: 'Автостоянка № 91', district: 'Ленинский' },
                { lat: 53.8604, lng: 27.4687, address: 'ул. Рафиева, 58', description: 'Автостоянка № 33', district: 'Московский' },
                { lat: 53.8679, lng: 27.4764, address: 'пр-т им. Газеты "Звезда", 49а', description: 'Автостоянка № 58', district: 'Московский' },
                { lat: 53.8513, lng: 27.4582, address: 'ул. Наполеона Орды, 30', description: 'Автостоянка № 79', district: 'Московский' },
                { lat: 53.8559, lng: 27.4475, address: 'ул. Слободская, 8', description: 'Автостоянка № 88', district: 'Московский' },
                { lat: 53.8559, lng: 27.4485, address: 'ул. Слободская, 6', description: 'Автостоянка № 89', district: 'Московский' },
                { lat: 53.8732, lng: 27.4870, address: 'ул. Алибегова, 1', description: 'Автостоянка № 107', district: 'Московский' },
                { lat: 53.8624, lng: 27.5303, address: 'ул. Барамзиной Т.Н., 5', description: 'Автостоянка № 4', district: 'Октябрьский' },
                { lat: 53.8441, lng: 27.5367, address: 'ул. Корженевского, 16д', description: 'Автостоянка № 8', district: 'Октябрьский' },
                { lat: 53.8828, lng: 27.5458, address: 'ул. Могилевская, 36', description: 'Отдельностоящая велопарковка 5002', district: 'Октябрьский' },
                { lat: 53.9038, lng: 27.6111, address: 'ул. Клумова, 18', description: 'Автостоянка № 95', district: 'Партизанский' },
                { lat: 53.9317, lng: 27.6253, address: 'ул. Кнорина, 59', description: 'Автостоянка № 27', district: 'Первомайский' },
                { lat: 53.9313, lng: 27.6416, address: 'ул. Калиновского, 117', description: 'Автостоянка № 29', district: 'Первомайский' },
                { lat: 53.9113, lng: 27.6006, address: 'пер. Козлова, 21', description: 'Автостоянка № 60', district: 'Первомайский' },
                { lat: 53.9438, lng: 27.6917, address: 'ул. Академика Высоцкого, 54', description: 'Автостоянка № 101', district: 'Первомайский' },
                { lat: 53.9100, lng: 27.4200, address: 'ул. Каменногорская', description: 'Автостоянка № 7', district: 'Фрунзенский' },
                { lat: 53.8967, lng: 27.4410, address: 'ул. М. Горецкого, 28а', description: 'Автостоянка № 31', district: 'Фрунзенский' },
                { lat: 53.8797, lng: 27.4429, address: 'ул. Шаранговича, 79', description: 'Автостоянка № 37', district: 'Фрунзенский' },
                { lat: 53.9150, lng: 27.4646, address: '2-й пер. Тимошенко, 5', description: 'Автостоянка № 53', district: 'Фрунзенский' },
                { lat: 53.8938, lng: 27.4172, address: 'ул. Лобанка, 114', description: 'Автостоянка № 54', district: 'Фрунзенский' },
                { lat: 53.9015, lng: 27.4334, address: 'ул. Горецкого, 6', description: 'Автостоянка № 65', district: 'Фрунзенский' },
                { lat: 53.9167, lng: 27.4608, address: 'ул. Тимошенко, 25', description: 'Автостоянка № 69', district: 'Фрунзенский' },
                { lat: 53.9167, lng: 27.4598, address: 'ул. Тимошенко, 27', description: 'Автостоянка № 70', district: 'Фрунзенский' },
                { lat: 53.8941, lng: 27.4042, address: 'ул. Маршала Лосика', description: 'Автостоянка № 87', district: 'Фрунзенский' },
                { lat: 53.9158, lng: 27.4384, address: 'ул. В. Голубка, 8', description: 'Автостоянка № 99', district: 'Фрунзенский' },
                { lat: 53.9174, lng: 27.4071, address: 'ул. Каменногорская, 100а', description: 'Автостоянка № 108', district: 'Фрунзенский' },
                { lat: 53.9181, lng: 27.4217, address: 'ул. Каменногорская, 62', description: 'Отдельностоящая велопарковка 5001', district: 'Фрунзенский' },
                { lat: 53.9298, lng: 27.5192, address: 'ул. Радужная, 5', description: 'Автостоянка № 56', district: 'Центральный' },
                { lat: 53.9598, lng: 27.5358, address: 'ул. П. Медёлки, 13', description: 'Автостоянка № 110', district: 'Центральный' },
                { lat: 53.9213, lng: 27.5756, address: 'ул. Кульман, 46', description: 'Автостоянка № 85', district: 'Советский' }
            ];

            const map = L.map('map').setView([53.9024, 27.5618], 11);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '© <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
            }).addTo(map);

            const parkingIcon = L.divIcon({
                html: 'P',
                className: 'parking-icon',
                iconSize: [28, 28],
                iconAnchor: [14, 28],
                popupAnchor: [0, -28]
            });
            
            bikeParkingData.forEach(parking => {
                const marker = L.marker([parking.lat, parking.lng], { icon: parkingIcon }).addTo(map);
                
                // Создаем HTML для popup
                const popupContent = `
                    <div class="font-sans">
                        <p class="font-bold text-base">${parking.address}</p>
                        <p class="text-gray-600">${parking.description}</p>
                        <div class="mt-2 flex space-x-2">
                            <button class="popup-button route-btn" data-lat="${parking.lat}" data-lng="${parking.lng}">
                               <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 7l5 5m0 0l-5 5m5-5H6" /></svg>
                                Маршрут
                            </button>
                            <button class="popup-button copy-btn" data-address="${parking.address}">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>
                                Копировать
                            </button>
                        </div>
                    </div>
                `;
                marker.bindPopup(popupContent);
            });

            // Обработчик для кнопок в popup
            map.on('popupopen', function(e) {
                const popupNode = e.popup.getElement();
                
                const routeBtn = popupNode.querySelector('.route-btn');
                if (routeBtn) {
                    routeBtn.addEventListener('click', function() {
                        const lat = this.dataset.lat;
                        const lng = this.dataset.lng;
                        if (userLocation) {
                            const url = `https://www.google.com/maps/dir/?api=1&origin=${userLocation.lat},${userLocation.lng}&destination=${lat},${lng}&travelmode=bicycling`;
                            window.open(url, '_blank');
                        } else {
                            showNotification('Сначала определите свое местоположение, нажав на кнопку "Найти меня".');
                        }
                    });
                }
                
                const copyBtn = popupNode.querySelector('.copy-btn');
                if (copyBtn) {
                    copyBtn.addEventListener('click', function() {
                        const address = this.dataset.address;
                        const textArea = document.createElement("textarea");
                        textArea.value = address;
                        document.body.appendChild(textArea);
                        textArea.select();
                        try {
                            document.execCommand('copy');
                            showNotification(`Адрес скопирован: ${address}`);
                        } catch (err) {
                            showNotification('Не удалось скопировать адрес.');
                        }
                        document.body.removeChild(textArea);
                    });
                }
            });

            const LocateControl = L.Control.extend({
                options: { position: 'topleft' },
                onAdd: function (map) {
                    const container = L.DomUtil.create('div', 'leaflet-bar leaflet-control leaflet-control-custom');
                    container.title = 'Найти мое местоположение';
                    container.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" /></svg>`;
                    L.DomEvent.disableClickPropagation(container);
                    container.onclick = function() {
                        map.locate({ setView: true, maxZoom: 16 });
                    };
                    return container;
                }
            });

            map.addControl(new LocateControl());

            let userLocationMarker = null;
            let userLocationCircle = null;

            map.on('locationfound', function(e) {
                userLocation = e.latlng; // Сохраняем местоположение
                if (userLocationMarker) map.removeLayer(userLocationMarker);
                if (userLocationCircle) map.removeLayer(userLocationCircle);
                const radius = e.accuracy;
                userLocationMarker = L.marker(e.latlng).addTo(map)
                    .bindPopup(`Вы где-то здесь (в радиусе ${Math.round(radius)} метров)`).openPopup();
                userLocationCircle = L.circle(e.latlng, radius).addTo(map);
            });

            map.on('locationerror', function(e) {
                showNotification('Не удалось определить ваше местоположение. Убедитесь, что вы разрешили доступ.');
            });

            // Функция для показа уведомлений
            function showNotification(text) {
                const notification = document.createElement('div');
                notification.style.cssText = 'position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: white; padding: 12px 20px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 2000; font-family: "Inter", sans-serif; font-size: 14px;';
                notification.textContent = text;
                document.body.appendChild(notification);
                setTimeout(() => {
                    notification.remove();
                }, 3000);
            }
        });
    </script>
</body>
</html>
